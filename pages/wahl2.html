<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Briefwahlanforderung</title>

<style>
body {
  background-color: #228B22;
  font-family: Arial, sans-serif;
  color: white;
  text-align: center;
  padding: 40px;
}
h2 {
  font-size: 2em;
  margin-bottom: 20px;
}
#info {
  margin-bottom: 20px;
  font-size: 1.1em;
}
.form-box {
  background: #ffffff;
  color: #000000;
  border-radius: 12px;
  padding: 25px;
  max-width: 500px;
  margin: 0 auto 30px auto;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  text-align: left;
}
.form-box h3 {
  text-align: center;
  margin-bottom: 15px;
  color: #228B22;
}
label {
  display: block;
  margin-top: 12px;
  font-size: 1.05em;
  font-weight: bold;
}
input {
  padding: 8px;
  font-size: 1em;
  width: 100%;
  border-radius: 6px;
  border: 1px solid #ccc;
  margin-top: 5px;
}
.button-group {
  text-align: center;
}
button {
  margin: 12px 8px;
  padding: 12px 24px;
  font-size: 1.1em;
  border: none;
  border-radius: 8px;
  background-color: #228B22;
  color: #ffffff;
  font-weight: bold;
  cursor: pointer;
}
button:hover {
  background-color: #1b6d1b;
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>

<h2>Briefwahlanforderung</h2>
<div id="info"></div>

<div class="form-box">
  <h3>Ihre Angaben</h3>

  <label>Vorname:</label>
  <input type="text" id="vorname">

  <label>Nachname:</label>
  <input type="text" id="nachname">

  <label>Personalnummer:</label>
  <input type="text" id="pnr">

  <label>Grund der Abwesenheit (optional):</label>
  <input type="text" id="grund" placeholder="z. B. Urlaub, Dienstreise, Krankheit">

  <label>Absenderanschrift:</label>
  <input type="text" id="absender" placeholder="Straße Hausnr.">

  <label>PLZ Ort:</label>
  <input type="text" id="wohnort" placeholder="PLZ Ort">
</div>

<div class="button-group">
  <button onclick="sendMail()">E-Mail senden</button>
  <button onclick="downloadPDF()">Daten als PDF speichern</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const params = new URLSearchParams(window.location.search);

  const betrieb = params.get("betrieb") || "";
  const vorsitz = params.get("vorsitz") || "";
  const anschrift = params.get("anschrift") || "";
  const email = params.get("email") || "wahlvorstand@firma.de";

  const infoBox = document.getElementById("info");

  if (betrieb || vorsitz || anschrift) {
    infoBox.innerHTML = `
      <p><b>Wahlbetrieb:</b> ${betrieb}</p>
      <p><b>Vorsitzender:</b> ${vorsitz}</p>
      <p><b>Anschrift:</b> ${anschrift}</p>
      <p><b>E-Mail:</b> ${email}</p>
    `;
  }

  window.buildMailText = function(vorname, nachname, pnr, grund) {
    const grundText = grund 
      ? `wegen ${grund}` 
      : "wegen Abwesenheit vom Betrieb";

    return `Sehr geehrte Damen und Herren,

hiermit beantrage ich ${vorname} ${nachname} gemäß § 24 Absatz 1 Wahlordnung BetrVG
die schriftliche Stimmabgabe, da ich zum Zeitpunkt der Wahl ${grundText} verhindert bin.

Mit freundlichen Grüßen

${vorname} ${nachname}
Personalnummer: ${pnr}`;
  };

  window.sendMail = function() {

    const vorname = document.getElementById("vorname").value.trim();
    const nachname = document.getElementById("nachname").value.trim();
    const pnr = document.getElementById("pnr").value.trim();
    const grund = document.getElementById("grund").value.trim();

    if (!vorname || !nachname || !pnr) {
      alert("Bitte alle Pflichtfelder ausfüllen!");
      return;
    }

    const subject = `Briefwahlanforderung zur BR-Wahl - ${betrieb}`;
    const mailtext = buildMailText(vorname, nachname, pnr, grund);

    window.location.href =
      `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(mailtext)}`;
  };

  window.downloadPDF = function() {

    const vorname = document.getElementById("vorname").value.trim();
    const nachname = document.getElementById("nachname").value.trim();
    const pnr = document.getElementById("pnr").value.trim();
    const grund = document.getElementById("grund").value.trim();
    const absender = document.getElementById("absender").value.trim();
    const wohnort = document.getElementById("wohnort").value.trim();

    if (!vorname || !nachname || !pnr) {
      alert("Bitte alle Pflichtfelder ausfüllen!");
      return;
    }

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.setFontSize(12);

    let y = 20;

    if (absender) {
      pdf.text(`${vorname} ${nachname}`, 20, y);
      y += 6;
      pdf.text(absender, 20, y);
      y += 6;
      pdf.text(wohnort, 20, y);
      y += 6;
      pdf.text(`Personalnummer: ${pnr}`, 20, y);
      y += 12;
    }

    pdf.text("An den Wahlvorstand", 20, y);
    y += 6;
    pdf.text(vorsitz, 20, y);
    y += 6;
    pdf.text(anschrift, 20, y);
    y += 20;

    const mailtext = buildMailText(vorname, nachname, pnr, grund);
    const splitText = pdf.splitTextToSize(mailtext, 170);
    pdf.text(splitText, 20, y);

    pdf.save("briefwahlanforderung.pdf");
  };

});
</script>

</body>
</html>